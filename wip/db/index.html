<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">

    

    <title>Mu-Haskell: Databases</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mu is a purely functional library for building microservices.">
    <meta name="keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="/mu-haskell/wip/img/poster.png" />
    <meta property="og:title" content="Mu-Haskell: Databases" />
    <meta property="og:site_name" content="Mu-Haskell: Databases" />
    <meta property="og:url" content="https://higherkindess.io/mu-haskell" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Mu is a purely functional library for building microservices." />
    <meta property="og:keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Mu is a purely functional library for building microservices." />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@47deg">
    <meta name="twitter:creator" content="@47deg">
    <meta name="twitter:image" content="/mu-haskell/wip/img/poster.png" />

    <meta property="github-info" data-github-owner="higherkindness" data-github-repo="mu-haskell" />

    <script defer src="/mu-haskell/wip/js/docs.js"></script>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/mu-haskell/wip/img/favicon.png">

    <!-- mu-haskell docs css -->
    <link rel="stylesheet" type="text/css" href="/mu-haskell/wip/css/docs.css">
</head>

    <body>
        <div id="site-sidebar" class="site-sidebar">
  <div class="sidebar-brand">
    <a href="/mu-haskell/wip/" class="brand" title="Mu-Haskell">
      <img
        src="/mu-haskell/wip/img/nav-brand-white.svg"
        alt="Mu-Haskell"
        class="brand-wrapper"
      />
      <span>Mu-Haskell</span>
    </a>
    <button
      id="main-toggle"
      type="button"
      title="Close"
      class="button sidebar-toggle"
    >
      <span class="close"></span>
    </button>
  </div>
  <div class="sidebar-menu">
    
      

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
      
      <a
        href="/mu-haskell/wip/"
        class=""
        title="Start"
      >
        Start
      </a>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Introduction"
        class="button drop-nested"
      >
        Introduction
      </button>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/intro-rpc/"
          title="For RPC"
        >
          For RPC
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/intro-graphql/"
          title="For GraphQL"
        >
          For GraphQL
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <a
        href="/mu-haskell/wip/schema/"
        title="Schemas"
        class="drop-nested"
      >
        Schemas
      </a>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/serializers/"
          title="Serialization formats"
        >
          Serialization formats
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/registry/"
          title="Registry"
        >
          Registry
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/optics/"
          title="Mu-Optics"
        >
          Mu-Optics
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <a
        href="/mu-haskell/wip/rpc/"
        title="Services"
        class="drop-nested"
      >
        Services
      </a>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/grpc/server/"
          title="gRPC servers"
        >
          gRPC servers
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/grpc/client/"
          title="gRPC clients"
        >
          gRPC clients
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/graphql/"
          title="GraphQL"
        >
          GraphQL
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/openapi/"
          title="OpenAPI / REST"
        >
          OpenAPI / REST
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  open">
       
      <button
        type="button"
        title="Open Integrations"
        class="button drop-nested"
      >
        Integrations
      </button>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class="active"
          href="/mu-haskell/wip/db/"
          title="Databases"
        >
          Databases
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/transformer/"
          title="Transformers"
        >
          Transformers
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/wip/middleware/"
          title="Middleware"
        >
          Middleware
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
      
      <a
        href="/mu-haskell/wip/talks/"
        class=""
        title="Talks"
      >
        Talks
      </a>
      
    </div>
    
    
  </div>
</div>

        <main id="site-doc" class="site-doc">
    <div class="doc-header">
      <button
        id="menu-toggle"
        type="button"
        class="button doc-toggle"
        title="Toggle">
          <img src="/mu-haskell/wip/img/sidebar-icon-open.svg" alt="Toggle" title="Toggle">
      </button>

      <div class="link-container">
        
        <div id="version-dropdown" class="link-item">

    <button class="button link-like strong" onclick="openDropdown(event)" title="Version">
      
        <i class="nav-item-icon fa fa-lg " aria-hidden="true"></i>
        <span class="nav-item-text">Version</span>
      
    </button>

    <ul class="dropdown dropdown-content">
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Stable" href="https://higherkindness.io/mu-haskell/" target="_blank" rel="noopener noreferrer">
            <span>
              Stable
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Next" href="https://higherkindness.io/mu-haskell/wip" target="_blank" rel="noopener noreferrer">
            <span>
              Next
            </span>
        </a>
      </li>
      
    </ul>

</div>

        
        <div id="api-docs-dropdown" class="link-item">

    <button class="button link-like strong" onclick="openDropdown(event)" title="API Docs">
      
        <i class="nav-item-icon fa fa-lg " aria-hidden="true"></i>
        <span class="nav-item-text">API Docs</span>
      
    </button>

    <ul class="dropdown dropdown-content">
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Stable" href="https://higherkindness.io/mu-haskell/haddock" target="_blank" rel="noopener noreferrer">
            <span>
              Stable
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Next" href="https://higherkindness.io/mu-haskell/wip/haddock" target="_blank" rel="noopener noreferrer">
            <span>
              Next
            </span>
        </a>
      </li>
      
    </ul>

</div>

        
        <div class="link-item">
          <a href="https://github.com/higherkindness/mu-haskell" title="GitHub repo" target="_blank" rel="noopener noreferrer">
            <span class="strong">GitHub</span>
            <span id="stars-count"></span>
          </a>
        </div>
      </div>

    </div>
    <div class="doc-content">
        <h1 id="databases">Databases</h1>

<p>In this section of the docs, to have a clearer understanding of how one would use <code class="highlighter-rouge">mu-haskell</code> to talk to a database, we are going to have a walk through the example of <a href="https://github.com/higherkindness/mu-haskell/tree/master/examples/with-persistent"><code class="highlighter-rouge">with-persistent</code></a>.</p>

<h2 id="first-steps">First steps</h2>

<p>We are going to start with our source of truth: the proto file.</p>

<div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"google/protobuf/empty.proto"</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">withpersistent</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">PersonRequest</span> <span class="p">{</span> <span class="kt">int64</span> <span class="na">identifier</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="kd">message</span> <span class="nc">Person</span> <span class="p">{</span> <span class="n">PersonRequest</span> <span class="na">pid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="kt">int32</span> <span class="na">age</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="p">}</span>

<span class="kd">service</span> <span class="n">PersistentService</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">getPerson</span> <span class="p">(</span><span class="n">PersonRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Person</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">newPerson</span> <span class="p">(</span><span class="n">Person</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">PersonRequest</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">allPeople</span> <span class="p">(</span><span class="n">google.protobuf.Empty</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">Person</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Maybe this example looks a bit contrived but bear with me, it covers a common use case when working with protobuf: that one of the messages has another message as its identifying key.</p>

<h2 id="defining-our-schema">Defining our Schema</h2>

<p>You are going to need to enable the following extensions:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# language DataKinds                  #-}</span>
<span class="cp">{-# language DeriveGeneric              #-}</span>
<span class="cp">{-# language DerivingVia                #-}</span>
<span class="cp">{-# language FlexibleContexts           #-}</span>
<span class="cp">{-# language FlexibleInstances          #-}</span>
<span class="cp">{-# language GADTs                      #-}</span>
<span class="cp">{-# language GeneralizedNewtypeDeriving #-}</span>
<span class="cp">{-# language MultiParamTypeClasses      #-}</span>
<span class="cp">{-# language OverloadedStrings          #-}</span>
<span class="cp">{-# language PolyKinds                  #-}</span>
<span class="cp">{-# language QuasiQuotes                #-}</span>
<span class="cp">{-# language ScopedTypeVariables        #-}</span>
<span class="cp">{-# language StandaloneDeriving         #-}</span>
<span class="cp">{-# language TemplateHaskell            #-}</span>
<span class="cp">{-# language TypeFamilies               #-}</span>
<span class="cp">{-# language TypeOperators              #-}</span>
<span class="cp">{-# language UndecidableInstances       #-}</span>
</code></pre></div></div>

<p>As we‚Äôve seen in the rest of the docs, we define our own data types to mirror our protobuf schema:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">grpc</span> <span class="s">"PersistentSchema"</span> <span class="n">id</span> <span class="s">"with-persistent.proto"</span>

<span class="kr">newtype</span> <span class="kt">MPersonRequest</span> <span class="o">=</span> <span class="kt">MPersonRequest</span>
  <span class="p">{</span> <span class="n">identifier</span> <span class="o">::</span> <span class="kt">Int64</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span> <span class="kt">Show</span><span class="p">,</span> <span class="kt">Ord</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">ToSchema</span>   <span class="kt">PersistentSchema</span> <span class="s">"PersonRequest"</span> <span class="kt">MPersonRequest</span>
<span class="kr">instance</span> <span class="kt">FromSchema</span> <span class="kt">PersistentSchema</span> <span class="s">"PersonRequest"</span> <span class="kt">MPersonRequest</span>

<span class="kr">data</span> <span class="kt">MPerson</span> <span class="o">=</span> <span class="kt">MPerson</span>
  <span class="p">{</span> <span class="n">pid</span>  <span class="o">::</span> <span class="kt">Maybe</span> <span class="kt">MPersonRequest</span>
  <span class="p">,</span> <span class="n">name</span> <span class="o">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
  <span class="p">,</span> <span class="n">age</span>  <span class="o">::</span> <span class="kt">Int32</span>
  <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span> <span class="kt">Ord</span><span class="p">,</span> <span class="kt">Show</span><span class="p">,</span> <span class="kt">Generic</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">ToSchema</span>   <span class="kt">PersistentSchema</span> <span class="s">"Person"</span> <span class="kt">MPerson</span>
<span class="kr">instance</span> <span class="kt">FromSchema</span> <span class="kt">PersistentSchema</span> <span class="s">"Person"</span> <span class="kt">MPerson</span>
</code></pre></div></div>

<p>Remember that all the magic starts with that first <code class="highlighter-rouge">grpc</code> line! ‚ú®</p>

<p>You might have noticed that this time, we are not using <code class="highlighter-rouge">DeriveAnyClass</code>, so we need to write the instances for <code class="highlighter-rouge">ToSchema</code> and <code class="highlighter-rouge">FromSchema</code> on a separate line from our deriving clause, and let GHC fill them for us. This decision was made due to a current <a href="https://github.com/yesodweb/persistent/issues/578">bug in Persistent</a>, but hopefully it will be fixed in future versions. üôÇ</p>

<h2 id="integration-with-persistent">Integration with <code class="highlighter-rouge">persistent</code></h2>

<p>This is the bit that changes the most. Since we are interested in storing in our database only the <code class="highlighter-rouge">Person</code> entities, we are going to declare only that <code class="highlighter-rouge">Entity</code> using TemplateHaskell and <code class="highlighter-rouge">persistent-template</code>.</p>

<p>For our specific example we are going to integrate with <code class="highlighter-rouge">persistent-sqlite</code>, but feel free to use whatever database you prefer! üòâ</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">import</span>           <span class="nn">Data.Int</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span>               <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span>           <span class="nn">Database.Persist.Sqlite</span>
<span class="kr">import</span>           <span class="nn">Database.Persist.TH</span>

<span class="n">mkPersist</span> <span class="n">sqlSettings</span> <span class="o">[</span><span class="n">persistLowerCase</span><span class="o">|</span>
Person json
  name T.Text
  age  Int32
  deriving Show Generic
<span class="o">|]</span>
</code></pre></div></div>

<p>Notice how we are deriving <code class="highlighter-rouge">Generic</code> also with Persistent‚Äôs QuasiQuotes.</p>

<h2 id="fixing-the-id-access-issue">Fixing the Id access issue</h2>

<p>If you have worked with <code class="highlighter-rouge">persistent</code> before, you‚Äôll know that it generates it‚Äôs own Ids, and this is very convenient. In our example, we‚Äôll get for free a <code class="highlighter-rouge">PersonId</code> field which is what we want to get with our <code class="highlighter-rouge">PersonRequest</code>.</p>

<p>But, how to derive the correct instance of <code class="highlighter-rouge">ToSchema</code> that <code class="highlighter-rouge">Mu</code> needs to work it‚Äôs magic? How can we explicitly define this mapping?</p>

<p>We have created some utilities to help you integrate with Persistent in our <a href="https://github.com/higherkindness/mu-haskell/tree/master/adapter/persistent"><code class="highlighter-rouge">mu-persistent</code> package</a>. One of such is <code class="highlighter-rouge">WithEntityNestedId</code>, you can use it along with <code class="highlighter-rouge">DerivingVia</code> to fit our needs:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">type</span> <span class="kt">PersonFieldMapping</span>
  <span class="o">=</span> <span class="sc">'[</span><span class="err"> </span><span class="s">"personAge"</span> <span class="sc">':</span><span class="err">-</span><span class="o">&gt;</span> <span class="s">"age"</span><span class="p">,</span> <span class="s">"personName"</span> <span class="sc">':</span><span class="err">-</span><span class="o">&gt;</span> <span class="s">"name"</span> <span class="p">]</span>

<span class="kr">deriving</span> <span class="n">via</span> <span class="p">(</span><span class="kt">WithEntityNestedId</span> <span class="s">"Person"</span> <span class="kt">PersonFieldMapping</span> <span class="p">(</span><span class="kt">Entity</span> <span class="kt">Person</span><span class="p">))</span>
  <span class="kr">instance</span> <span class="kt">ToSchema</span> <span class="kt">PersistentSchema</span> <span class="s">"Person"</span> <span class="p">(</span><span class="kt">Entity</span> <span class="kt">Person</span><span class="p">)</span>
</code></pre></div></div>

<p>Have in mind that we still need to define our own custom field mapping, in this case <code class="highlighter-rouge">PersonFieldMapping</code> so that the deriving via does its job properly.</p>

<h2 id="running-a-pool-of-database-connections">Running a pool of database connections</h2>

<p>Now let‚Äôs focus on the Server!</p>

<p>All you need to do is open the database once, and share the connection across all your services:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# language FlexibleContexts      #-}</span>
<span class="cp">{-# language OverloadedStrings     #-}</span>
<span class="cp">{-# language PartialTypeSignatures #-}</span>
<span class="cp">{-# language TypeApplications      #-}</span>
<span class="cp">{-# language TypeFamilies          #-}</span>

<span class="kr">module</span> <span class="nn">Server</span> <span class="kr">where</span>

<span class="kr">import</span>           <span class="nn">Control.Monad.Logger</span>
<span class="kr">import</span>           <span class="nn">Mu.GRpc.Server</span>
<span class="kr">import</span>           <span class="nn">Mu.Server</span>

<span class="n">main</span> <span class="o">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span>
  <span class="n">runStderrLoggingT</span> <span class="o">$</span>
    <span class="n">withSqliteConn</span> <span class="o">@</span><span class="p">(</span><span class="kt">LoggingT</span> <span class="kt">IO</span><span class="p">)</span> <span class="s">"example.db"</span> <span class="o">$</span> <span class="nf">\</span><span class="n">conn</span> <span class="o">-&gt;</span>
      <span class="n">liftIO</span> <span class="o">$</span> <span class="n">runGRpcApp</span> <span class="n">msgProtoBuf</span> <span class="mi">8080</span> <span class="p">(</span><span class="n">server</span> <span class="n">conn</span><span class="p">)</span>
</code></pre></div></div>

<p>We have decided in this example to use <code class="highlighter-rouge">LoggingT</code> from <code class="highlighter-rouge">monad-logger</code> and <code class="highlighter-rouge">runStderrLoggingT</code> to get some basic database logs to the console for free, but this is not a must!</p>

<h2 id="this-actually-does-not-work">This actually does not work</h2>

<p>Maybe you might have noticed that this example is not going to work yet. Unless you created <code class="highlighter-rouge">example.db</code> yourself, we need to define a ‚Äúmigration‚Äù. Migrations are not actually <em>required</em> by Persistent, they are just a simple way to get an Sqlite database up and running.</p>

<p>We need a small tweak in our <code class="highlighter-rouge">Schema.hs</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- mkPersist sqlSettings [persistLowerCase|
</span><span class="gi">+ share [mkPersist sqlSettings, mkMigrate "migrateAll"] [persistLowerCase|
</span>  Person json
  ...
</code></pre></div></div>

<p>And another one on our <code class="highlighter-rouge">Server.hs</code>:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">main :: IO ()
main =
</span>  runStderrLoggingT $
<span class="gd">-   withSqliteConn @(LoggingT IO) "example.db" $ \conn -&gt;
</span><span class="gi">+   withSqliteConn @(LoggingT IO) "example.db" $ \conn -&gt; do
+     runDb conn $ runMigration migrateAll
</span>      liftIO $ runGRpcApp msgProtoBuf 8080 (server conn)
</code></pre></div></div>

<p>More on that strange <code class="highlighter-rouge">runDb</code> method in the next section! üòá</p>

<h2 id="sample-usage-with-a-service">Sample usage with a service</h2>

<p>All the pieces are now in place, let‚Äôs check the implementation of the <code class="highlighter-rouge">allPeople</code> service:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">allPeople</span>
  <span class="o">::</span> <span class="kt">SqlBackend</span>
  <span class="o">-&gt;</span> <span class="kt">ConduitT</span> <span class="p">(</span><span class="kt">Entity</span> <span class="kt">Person</span><span class="p">)</span> <span class="kt">Void</span> <span class="kt">ServerErrorIO</span> <span class="nb">()</span>
  <span class="o">-&gt;</span> <span class="kt">ServerErrorIO</span> <span class="nb">()</span>
<span class="n">allPeople</span> <span class="n">conn</span> <span class="n">sink</span> <span class="o">=</span> <span class="n">runDb</span> <span class="n">conn</span> <span class="o">$</span>
  <span class="n">runConduit</span> <span class="o">$</span> <span class="n">selectSource</span> <span class="kt">[]</span> <span class="kt">[]</span> <span class="o">.|</span> <span class="n">liftServerConduit</span> <span class="n">sink</span>
</code></pre></div></div>

<p>As you can see, all the services need to be passed the <code class="highlighter-rouge">SqlBackend</code> connection as an argument.</p>

<p>Two interesting things we want to highlight here: we have provided a small helper called <code class="highlighter-rouge">runDb</code>, its implementation is quite simple and it exists due to <strong>developer ergonomics</strong>. We are basically saving you from writing lots of <code class="highlighter-rouge">liftIO $ flip runSqlPersistM</code>. üòâ</p>

<p>The second one will be discussed in the next section.</p>

<h2 id="on-streams-and-conduit">On streams and <code class="highlighter-rouge">Conduit</code></h2>

<p>Since we are going to work with streams, it is wonderful that <code class="highlighter-rouge">persistent</code> also provides methods to work with <code class="highlighter-rouge">Conduit</code> like, for example, <code class="highlighter-rouge">selectSource</code>. However‚Ä¶</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- ConduitM () (Entity Person) m ()               -- the Monad in which persistent operates
</span><span class="gi">+ ConduitT (Entity Person) Void ServerErrorIO () -- the Monad we know we want instead... ü§î
</span></code></pre></div></div>

<p>Well, have no fear my friend because we created yet another utility called <code class="highlighter-rouge">liftServerConduit</code>, born specifically to address this problem. Its type signature is:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">liftServerConduit</span>
  <span class="o">::</span> <span class="kt">MonadIO</span> <span class="n">m</span>
  <span class="o">=&gt;</span> <span class="kt">ConduitT</span> <span class="n">a</span> <span class="n">b</span> <span class="kt">ServerErrorIO</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="kt">ConduitT</span> <span class="n">a</span> <span class="n">b</span> <span class="n">m</span> <span class="n">r</span>
</code></pre></div></div>

<p>What is this type signature telling us? That is, we can turn any of the Conduits given as input, which work on the <code class="highlighter-rouge">ServerErrorIO</code> Monad from <code class="highlighter-rouge">mu-rpc</code>, into a Conduit working on another <code class="highlighter-rouge">IO</code>-like Monad. This is the case, in particular, of the Monad in which Persistent runs.</p>

<p>And that concludes our round-trip!</p>

<p>If you think that something is not clear or could be further improved, feel free to <a href="https://github.com/higherkindness/mu-haskell/issues">open an Issue or Pull Request!</a> üòä</p>

    </div>
</main>

    </body>
</html>
