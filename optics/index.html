<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">

    

    <title>Mu-Haskell: Optics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mu is a purely functional library for building microservices.">
    <meta name="keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="/mu-haskell/img/poster.png" />
    <meta property="og:title" content="Mu-Haskell: Optics" />
    <meta property="og:site_name" content="Mu-Haskell: Optics" />
    <meta property="og:url" content="https://higherkindess.io/mu-haskell" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Mu is a purely functional library for building microservices." />
    <meta property="og:keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Mu is a purely functional library for building microservices." />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@47deg">
    <meta name="twitter:creator" content="@47deg">
    <meta name="twitter:image" content="/mu-haskell/img/poster.png" />

    <meta property="github-info" data-github-owner="higherkindness" data-github-repo="mu-haskell" />

    <script defer src="/mu-haskell/js/docs.js"></script>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/mu-haskell/img/favicon.png">

    <!-- mu-haskell docs css -->
    <link rel="stylesheet" type="text/css" href="/mu-haskell/css/docs.css">
</head>

    <body>
        <div id="site-sidebar" class="site-sidebar">
  <div class="sidebar-brand">
    <a href="/mu-haskell/" class="brand" title="Mu-Haskell">
      <img
        src="/mu-haskell/img/nav-brand-white.svg"
        alt="Mu-Haskell"
        class="brand-wrapper"
      />
      <span>Mu-Haskell</span>
    </a>
    <button
      id="main-toggle"
      type="button"
      title="Close"
      class="button sidebar-toggle"
    >
      <span class="close"></span>
    </button>
  </div>
  <div class="sidebar-menu">
    
      

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
      
      <a
        href="/mu-haskell/"
        class=""
        title="Start"
      >
        Start
      </a>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Introduction"
        class="button drop-nested"
      >
        Introduction
      </button>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/intro-rpc/"
          title="For RPC"
        >
          For RPC
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/intro-graphql/"
          title="For GraphQL"
        >
          For GraphQL
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  open">
       
      <a
        href="/mu-haskell/schema/"
        title="Schemas"
        class="drop-nested"
      >
        Schemas
      </a>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/serializers/"
          title="Serialization formats"
        >
          Serialization formats
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/registry/"
          title="Registry"
        >
          Registry
        </a>
        
        
        
        <a
          class="active"
          href="/mu-haskell/optics/"
          title="Mu-Optics"
        >
          Mu-Optics
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <a
        href="/mu-haskell/rpc/"
        title="RPC services"
        class="drop-nested"
      >
        RPC services
      </a>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/grpc/server/"
          title="gRPC servers"
        >
          gRPC servers
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/grpc/client/"
          title="gRPC clients"
        >
          gRPC clients
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
      
      <a
        href="/mu-haskell/graphql/"
        class=""
        title="GraphQL services"
      >
        GraphQL services
      </a>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Integrations"
        class="button drop-nested"
      >
        Integrations
      </button>
      <div class="caret"></div>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/mu-haskell/db/"
          title="Databases"
        >
          Databases
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/transformer/"
          title="Transformers"
        >
          Transformers
        </a>
        
        
        
        <a
          class=""
          href="/mu-haskell/middleware/"
          title="Middleware"
        >
          Middleware
        </a>
        
      </div>
      
    </div>
    
    
  </div>
</div>

        <main id="site-doc" class="site-doc">
    <div class="doc-header">
      <button
        id="menu-toggle"
        type="button"
        class="button doc-toggle"
        title="Toggle">
          <img src="/mu-haskell/img/sidebar-icon-open.svg" alt="Toggle" title="Toggle">
      </button>

      <div class="link-container">
        
        <div id="version-dropdown" class="link-item">

    <button class="button link-like strong" onclick="openDropdown(event)" title="Version">
      
        <i class="nav-item-icon fa fa-lg " aria-hidden="true"></i>
        <span class="nav-item-text">Version</span>
      
    </button>

    <ul class="dropdown dropdown-content">
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Stable" href="https://higherkindness.io/mu-haskell/" target="_blank" rel="noopener noreferrer">
            <span>
              Stable
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Next" href="https://higherkindness.io/mu-haskell/wip" target="_blank" rel="noopener noreferrer">
            <span>
              Next
            </span>
        </a>
      </li>
      
    </ul>

</div>

        
        <div id="api-docs-dropdown" class="link-item">

    <button class="button link-like strong" onclick="openDropdown(event)" title="API Docs">
      
        <i class="nav-item-icon fa fa-lg " aria-hidden="true"></i>
        <span class="nav-item-text">API Docs</span>
      
    </button>

    <ul class="dropdown dropdown-content">
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Stable" href="https://higherkindness.io/mu-haskell/haddock" target="_blank" rel="noopener noreferrer">
            <span>
              Stable
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" title="Next" href="https://higherkindness.io/mu-haskell/wip/haddock" target="_blank" rel="noopener noreferrer">
            <span>
              Next
            </span>
        </a>
      </li>
      
    </ul>

</div>

        
        <div class="link-item">
          <a href="https://github.com/higherkindness/mu-haskell" title="GitHub repo" target="_blank" rel="noopener noreferrer">
            <span class="strong">GitHub</span>
            <span id="stars-count"></span>
          </a>
        </div>
      </div>

    </div>
    <div class="doc-content">
        <h1 id="optics">Optics</h1>

<p>We created a new package <code class="highlighter-rouge">mu-optics</code> is available from <strong>release v0.3 of Mu-Haskell</strong>, and provides an easier API to build both servers and clients using lenses and prisms (probably the ultimate API üòâ). This document aims to be a reference of how to use this library and the common use cases for it.</p>

<h2 id="accessing-fields-with-field">Accessing fields with <code class="highlighter-rouge">#field</code></h2>

<p>When you want to refer to a method of your type-level schema, whereas in the server or the client, you can use the get operation from the lens (<code class="highlighter-rouge">^.</code>) in conjunction with the <code class="highlighter-rouge">OverloadedLabels</code> extension to access that field, as in this example. In this case, the label <code class="highlighter-rouge">#name</code> should have the same name as the field declared in the corresponding schema definition file.</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# language OverloadedLabels #-}</span>

<span class="n">sayHello</span> <span class="o">::</span> <span class="kt">MonadServer</span> <span class="n">m</span> <span class="o">=&gt;</span> <span class="kt">HelloRequestMessage'</span> <span class="o">-&gt;</span> <span class="n">m</span> <span class="kt">HelloReplyMessage'</span>
<span class="n">sayHello</span> <span class="p">(</span><span class="kt">HelloRequestMessage</span> <span class="n">nm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pure</span> <span class="o">$</span> <span class="n">record</span> <span class="p">(</span><span class="s">"hi, "</span> <span class="o">&lt;&gt;</span> <span class="n">nm</span> <span class="o">^.</span> <span class="o">#</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="generate-records-with-record-and-record1">Generate records with <code class="highlighter-rouge">record</code> and <code class="highlighter-rouge">record1</code></h2>

<p>Sometimes you need to create values that match the generated type-level schema representations, for example, to construct the request of a certain service. Usually, those types will be records, and to help you achieve that task we provided the helpers <code class="highlighter-rouge">record</code> and <code class="highlighter-rouge">record1</code>:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span> <span class="o">::</span> <span class="kt">GRpcConnection</span> <span class="kt">PersistentService</span> <span class="kt">'MsgProtoBuf</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">get</span> <span class="n">client</span> <span class="n">idPerson</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">request</span> <span class="o">=</span> <span class="n">read</span> <span class="n">idPerson</span>
  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">"GET: is there some person with id: "</span> <span class="o">++</span> <span class="n">idPerson</span> <span class="o">++</span> <span class="s">"?"</span>
  <span class="n">response</span> <span class="o">&lt;-</span> <span class="n">client</span> <span class="o">^.</span> <span class="o">#</span><span class="n">getPerson</span> <span class="o">$</span> <span class="n">record1</span> <span class="n">request</span> <span class="c1">-- &lt;- using `record1` to create a request</span>
  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">"GET: response was: "</span> <span class="o">++</span> <span class="n">show</span> <span class="n">response</span>
</code></pre></div></div>

<p>Why the difference? Well, due to some ambiguity in the context of our Schemas, we need to help GHC to know if the record we‚Äôre creating contains only one field (<code class="highlighter-rouge">record1</code>) or more (<code class="highlighter-rouge">record</code>) contained in a tuple of elements.</p>

<blockquote>
  <p>This design might be improved in the future, by using ‚Äú<a href="https://hackage.haskell.org/package/OneTuple-0.2.2.1/docs/Data-Tuple-OneTuple.html">OneTuple</a> to rule them all.‚Äù</p>
</blockquote>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add</span> <span class="o">::</span> <span class="kt">GRpcConnection</span> <span class="kt">PersistentService</span> <span class="kt">'MsgProtoBuf</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">add</span> <span class="n">client</span> <span class="n">nm</span> <span class="n">ag</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">person</span> <span class="o">=</span> <span class="n">record</span> <span class="p">(</span><span class="kt">Nothing</span><span class="p">,</span> <span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="n">nm</span><span class="p">,</span> <span class="n">read</span> <span class="n">ag</span><span class="p">)</span> <span class="c1">-- &lt;- using `record` to create Person, a more complex type</span>
  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">"ADD: creating new person "</span> <span class="o">++</span> <span class="n">nm</span> <span class="o">++</span> <span class="s">" with age "</span> <span class="o">++</span> <span class="n">ag</span>
  <span class="n">response</span> <span class="o">&lt;-</span> <span class="n">client</span> <span class="o">^.</span> <span class="o">#</span><span class="n">newPerson</span> <span class="n">person</span>
  <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">"ADD: was creating successful? "</span> <span class="o">++</span> <span class="n">show</span> <span class="n">response</span>
</code></pre></div></div>

<h2 id="generating-enums-with-enum">Generating enums with <code class="highlighter-rouge">enum</code></h2>

<p>Sometimes, besides using records, you‚Äôll have your types defined as something like enums, as in this protobuf example:</p>

<div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="n">Weather</span> <span class="p">{</span>
  <span class="na">sunny</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="na">cloudy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="na">rainy</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As expected, we also provided you with the tools you need to construct a valid enum-like value with the helper <code class="highlighter-rouge">enum</code>:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# language TypeApplications #-}</span>

<span class="kr">import</span> <span class="nn">Mu.Schema</span>
<span class="kr">import</span> <span class="nn">Mu.Schema.Optics</span>

<span class="kr">type</span> <span class="kt">Weather</span> <span class="o">=</span> <span class="kt">Term</span> <span class="kt">WeatherProtocol</span> <span class="p">(</span><span class="kt">WeatherProtocol</span> <span class="o">:/:</span> <span class="s">"Weather"</span><span class="p">)</span>

<span class="n">sunnyDays</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">Weather</span><span class="p">]</span>
<span class="n">sunnyDays</span> <span class="n">n</span> <span class="o">=</span> <span class="n">replicate</span> <span class="n">n</span> <span class="p">(</span><span class="n">enum</span> <span class="o">@</span><span class="s">"sunny"</span><span class="p">)</span> <span class="c1">-- &lt;- see the magic here! ‚ú®</span>
</code></pre></div></div>

<p>Simply enable <code class="highlighter-rouge">TypeApplications</code> and provide the value you are looking for to construct the enum! üöÄ</p>

<h2 id="accesing-enums-with-prisms">Accesing enums with prisms!</h2>

<p>Following with the example above, if you need to read an enum value, you can do so using prisms!</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# language OverloadedLabels #-}</span>

<span class="n">getWeather</span> <span class="o">::</span> <span class="kt">Weather</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">getWeather</span> <span class="n">e</span>
  <span class="o">|</span> <span class="n">e</span> <span class="p">`</span><span class="n">is</span><span class="p">`</span> <span class="o">#</span><span class="n">sunny</span>  <span class="o">=</span> <span class="n">putStrLn</span> <span class="s">"is sunny! üòÑ"</span>
  <span class="o">|</span> <span class="n">e</span> <span class="p">`</span><span class="n">is</span><span class="p">`</span> <span class="o">#</span><span class="n">cloudy</span> <span class="o">=</span> <span class="n">putStrLn</span> <span class="s">"is cloudy üòü"</span>
  <span class="o">|</span> <span class="n">e</span> <span class="p">`</span><span class="n">is</span><span class="p">`</span> <span class="o">#</span><span class="n">rainy</span>  <span class="o">=</span> <span class="n">putStrLn</span> <span class="s">"is rainy... üò≠"</span>
</code></pre></div></div>

<p>Again, notice the use of <code class="highlighter-rouge">OverloadedLabels</code> to refer to the possible enum values and our special <code class="highlighter-rouge">is</code> prism helper, which is just <code class="highlighter-rouge">is s k = isJust (preview k s)</code>, got it? isJust‚Ä¶ badum tss! ü•Å</p>

<h2 id="accessing-unions">Accessing unions</h2>

<p>Besides this, you have <code class="highlighter-rouge">_U0</code>, <code class="highlighter-rouge">_U1</code>, ‚Ä¶ and <code class="highlighter-rouge">_Next</code>, with the goal of giving prisms for the different possibilities of a union. So, lets say you have a field that is an union of <code class="highlighter-rouge">String</code> and <code class="highlighter-rouge">Int</code>, you can get prisms using <code class="highlighter-rouge">#field % _U0</code> and <code class="highlighter-rouge">#field % _U1</code>.</p>

<blockquote>
  <p>We know the naming of these might be terrible, but they follow the usual convention for this kind of stuff: <code class="highlighter-rouge">_</code> for a prism, <code class="highlighter-rouge">U</code> from ‚ÄúUnion‚Äù and then the index.</p>
</blockquote>

    </div>
</main>

    </body>
</html>
